<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SPaRC – Spatial Pathfinding Reasoning Challenge</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <link rel="manifest" href="/favicon/site.webmanifest" />
    
    <!-- Google meta information -->
    <meta name="description" content="SPaRC is a dataset of 1,000 two-dimensional grid puzzles for testing spatial reasoning in language models.">
    <meta name="keywords" content="spatial reasoning, pathfinding, language models, AI reasoning, spatial cognition">
    <meta name="author" content="Lars Benedikt Kaesberg, Jan Philip Wahle, Terry Ruas, Bela Gipp">
    
    <!-- Open Graph metadata for social sharing -->
    <meta property="og:title" content="SPaRC – Spatial Pathfinding Reasoning Challenge">
    <meta property="og:description" content="A dataset of 1,000 spatial reasoning puzzles revealing significant gaps between human and AI performance.">
    <meta property="og:image" content="graphics/images/teaser.png">
    <meta property="og:url" content="https://lkaesberg.github.io/SPaRC/">
    <meta property="og:type" content="website">
    
    <!-- Google Scholar metadata -->
    <meta name="citation_title" content="SPaRC: A Spatial Pathfinding Reasoning Challenge">
    <meta name="citation_author" content="Kaesberg, Lars Benedikt">
    <meta name="citation_author" content="Wahle, Jan Philip">
    <meta name="citation_author" content="Ruas, Terry">
    <meta name="citation_author" content="Gipp, Bela">
    <meta name="citation_publication_date" content="2025">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      /* Base styles */
      :root {
        --color-bg: #fafafa;
        --color-text: #333;
        --color-primary: #6366f1; /* Indigo */
        --color-accent: #f43f5e; /* Rose */
        --color-muted: #94a3b8; /* Slate */
        --color-success: #10b981; /* Emerald */
        --color-card: #ffffff;
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.04), 0 10px 15px rgba(0, 0, 0, 0.04);
        --radius-sm: 8px;
        --radius: 12px;
        --radius-lg: 16px;
        --font-base: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Prevent horizontal scrolling while allowing sticky elements */
      html {
        overflow-x: hidden;
        width: 100%;
        scroll-behavior: smooth;
      }
      
      body {
        width: 100%;
        position: relative;
        overflow-x: clip; /* Modern alternative to hidden that allows sticky */
        font-family: var(--font-base);
        background-color: var(--color-bg);
        color: var(--color-text);
        line-height: 1.7;
        font-weight: 400;
        font-size: 16px;
        margin: 0;
        padding: 0;
      }
      
      /* Ensure all elements respect viewport width */
      * {
        max-width: 100%;
        box-sizing: border-box;
      }
      
      /* Reset & globals */
      *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      img {
        max-width: 100%;
        height: auto;
      }
      
      a {
        color: var(--color-primary);
        text-decoration: none;
        transition: var(--transition);
      }
      
      a:hover {
        color: var(--color-accent);
      }
      
      /* Typography */
      h1, h2, h3, h4, h5 {
        font-weight: 600;
        line-height: 1.2;
        margin-bottom: 1rem;
      }
      
      h1 {
        font-size: clamp(2.5rem, 5vw, 3.5rem);
        letter-spacing: -0.03em;
      }
      
      h2 {
        font-size: clamp(1.8rem, 3vw, 2.2rem);
        letter-spacing: -0.02em;
      }
      
      h3 {
        font-size: 1.5rem;
        letter-spacing: -0.015em;
      }
      
      p {
        margin-bottom: 1.5rem;
      }
      
      strong {
        font-weight: 600;
      }
      
      /* Layout */
      .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1.5rem;
        box-sizing: border-box;
        overflow-x: hidden;
      }
      
      .grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 2rem;
      }
      
      /* Components */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: var(--color-primary);
        color: white;
        font-weight: 500;
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-sm);
        transition: var(--transition);
        border: none;
        cursor: pointer;
      }
      
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        color: white;
      }
      
      .btn-accent {
        background: var(--color-accent);
      }
      
      .btn-accent:hover {
        box-shadow: 0 4px 12px rgba(244, 63, 94, 0.2);
      }
      
      .card {
        background: var(--color-card);
        border-radius: var(--radius);
        box-shadow: var(--shadow-sm);
        padding: 2rem;
        transition: var(--transition);
      }
      
      .card:hover {
        box-shadow: var(--shadow);
      }
      
      /* Header */
      .site-header {
        position: relative;
        width: 100%;
        overflow: hidden;
        padding: 4rem 0;
        background: linear-gradient(135deg, #6366f1 0%, #818cf8 40%, #a5b4fc 100%);
        color: white;
      }
      
      @keyframes float {
        0% { transform: translateY(0px) translateX(0px); }
        50% { transform: translateY(-20px) translateX(10px); }
        100% { transform: translateY(0px) translateX(0px); }
      }
      
      @keyframes float-reverse {
        0% { transform: translateY(0px) translateX(0px); }
        50% { transform: translateY(20px) translateX(-10px); }
        100% { transform: translateY(0px) translateX(0px); }
      }
      
      @keyframes pulse {
        0% { opacity: 0.5; }
        50% { opacity: 0.8; }
        100% { opacity: 0.5; }
      }
      
      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      
      .site-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2V6h4V4H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        z-index: 0;
      }
      
      .header-content {
        position: relative;
        z-index: 1;
        text-align: center;
        max-width: 900px;
        margin: 0 auto;
      }
      
      /* Particle animation - enhanced */
      .particle-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 0;
        opacity: 0.7;
      }
      
      .particle {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        pointer-events: none;
      }
      
      .particle-1 {
        width: 400px;
        height: 400px;
        top: -100px;
        right: -100px;
        animation: float 15s ease-in-out infinite, pulse 8s ease-in-out infinite;
      }
      
      .particle-2 {
        width: 300px;
        height: 300px;
        bottom: -80px;
        left: -80px;
        animation: float-reverse 18s ease-in-out infinite, pulse 10s ease-in-out infinite;
      }
      
      .particle-3 {
        width: 200px;
        height: 200px;
        top: 40%;
        right: 25%;
        animation: float 12s ease-in-out infinite, pulse 6s ease-in-out infinite;
      }
      
      /* Title styling */
      .header-title {
        margin: 0;
        font-size: 4.5rem;
        font-weight: 700;
        letter-spacing: -0.03em;
        line-height: 1;
        margin-bottom: 0.5rem;
        background: linear-gradient(to right, #ffffff, #e0e7ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      
      .title-highlight {
        position: relative;
        display: inline-block;
      }
      
      .title-highlight::after {
        content: "";
        position: absolute;
        bottom: 0.1em;
        left: 0;
        width: 100%;
        height: 0.15em;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
      }
      
      .tagline {
        font-size: 1.2rem;
        margin-bottom: 1.5rem;
        font-weight: 300;
        opacity: 0.95;
        line-height: 1.5;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      
      /* Header meta section - combines stats and authors */
      .header-meta {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 2rem;
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: var(--radius);
        backdrop-filter: blur(5px);
      }
      
      .authors {
        font-size: 0.9rem;
        font-weight: 400;
        opacity: 0.9;
        line-height: 1.5;
        text-align: left;
        padding-left: 1.5rem;
        border-left: 1px solid rgba(255, 255, 255, 0.2);
      }
      
      .authors small {
        display: block;
        font-size: 0.8rem;
        opacity: 0.8;
      }
      
      /* Header stats */
      .header-stats {
        display: flex;
        gap: 1.5rem;
      }
      
      .header-stat {
        text-align: center;
      }
      
      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        line-height: 1;
        margin-bottom: 0.25rem;
        color: white;
      }
      
      .stat-label {
        font-size: 0.8rem;
        font-weight: 500;
        opacity: 0.8;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      /* Header buttons */
      .header-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        position: relative;
        z-index: 5;
        margin-bottom: 1rem;
      }
      
      .header-btn {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.7rem 1.5rem;
        font-weight: 500;
        font-size: 1rem;
        border-radius: 50px;
        transition: all 0.3s ease;
      }
      
      .header-btn-primary {
        background-color: white;
        color: var(--color-primary);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      
      .header-btn-primary:hover {
        box-shadow: 0 7px 20px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
      }
      
      .header-btn-secondary {
        background-color: rgba(255, 255, 255, 0.15);
        color: white;
        backdrop-filter: blur(5px);
      }
      
      .header-btn-secondary:hover {
        background-color: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
      }
      
      /* Responsive styles for header */
      @media (max-width: 768px) {
        .site-header {
          padding: 2rem 0;
        }
        
        .header-title {
          font-size: 3.5rem;
        }
        
        .tagline {
          font-size: 1rem;
        }
        
        .header-meta {
          flex-direction: column;
          gap: 1rem;
        }
        
        .authors {
          padding-left: 0;
          border-left: none;
          text-align: center;
          padding-top: 1rem;
          border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header-stats {
        width: 100%;
          justify-content: center;
        }
        
        .stat-number {
          font-size: 1.8rem;
        }
      }
      
      @media (max-width: 680px) {
        .header-buttons {
          flex-direction: column;
          gap: 0.5rem;
          margin-bottom: 2.5rem !important; /* Extra space on small mobile */
          padding-bottom: 1rem;
        }
        
        /* Adjust the spacing above the wave */
        .site-header {
          padding-bottom: 2rem;
        }
      }
      
      /* Navigation */
      .nav-container {
        border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        position: sticky !important;
        top: 0 !important;
        z-index: 1000;
        background: white;
        width: 100%;
        will-change: transform;
      }
      
      .main-nav {
        display: flex;
        justify-content: center;
        padding: 1rem 0;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .nav-list {
        display: flex;
        gap: 1.5rem;
        list-style: none;
      }
      
      .nav-item {
        white-space: nowrap;
      }
      
      .nav-link {
        color: var(--color-text);
        font-weight: 500;
        padding: 0.5rem 0.75rem;
        border-radius: var(--radius-sm);
        transition: var(--transition);
      }
      
      .nav-link:hover, .nav-link.active {
        color: var(--color-primary);
        background: rgba(99, 102, 241, 0.1);
      }
      
      /* Main content */
      .main-content {
        padding: 4rem 0;
      }
      
      .section {
        margin-bottom: 4rem;
      }
      
      .section-header {
        margin-bottom: 2rem;
        position: relative;
        display: flex;
        align-items: center;
      }
      
      .section-header::after {
        content: "";
        flex: 1;
        height: 1px;
        background: #e2e8f0;
        margin-left: 1rem;
      }
      
      .section-title {
        font-size: 1.8rem;
        margin-bottom: 0;
        color: var(--color-primary);
      }
      
      /* Hero Grid */
      .hero-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 2rem;
        margin-bottom: 3rem;
        width: 100%;
        max-width: 100%;
        overflow: hidden;
      }
      
      .visual-card {
        aspect-ratio: 16/9;
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        position: relative;
      }
      
      .visual-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow);
      }
      
      .visual-card img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        padding: 1rem;
      }
      
      .placeholder-text {
        color: var(--color-muted);
        font-weight: 500;
      }
      
      /* Stats Display */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin: 1rem 0 4rem;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        padding: 2rem;
        border-radius: var(--radius-lg);
      }
      
      .stat-card {
        text-align: center;
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
        padding: 2rem;
        border-top: 4px solid var(--color-primary);
      }
      
      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow);
      }
      
      .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--color-primary);
        line-height: 1;
        margin-bottom: 0.5rem;
      }
      
      .stat-label {
        color: var(--color-text);
        font-weight: 500;
        font-size: 1.1rem;
      }
      
      /* Feature Cards */
      .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
      }
      
      .feature-card {
        background: white;
        border-radius: var(--radius);
        padding: 1.5rem;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
        border-top: 4px solid var(--color-primary);
      }
      
      .feature-card:hover {
        transform: translateY(-7px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      }
      
      .feature-card h3 {
        margin-top: 0;
        font-size: 1.25rem;
      }
      
      /* Table Styles */
      .table-container {
        overflow-x: auto;
        margin: 2rem 0;
        border-radius: var(--radius);
        box-shadow: var(--shadow-sm);
      }
      
      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        background: white;
      }
      
      th, td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid #f1f5f9;
      }
      
      th {
        background: #f8fafc;
        font-weight: 600;
        color: var(--color-primary);
      }
      
      tbody tr:hover {
        background: #f8fafc;
      }
      
      /* Code Blocks */
      .code-block {
        background: #1e293b;
        color: #e2e8f0;
        padding: 1.5rem;
        border-radius: var(--radius);
        overflow-x: auto;
        margin: 1.5rem 0;
        font-family: 'SF Mono', 'Consolas', monospace;
        font-size: 0.9rem;
        line-height: 1.6;
        white-space: pre;
        tab-size: 2;
      }
      
      .code-block .comment {
        color: #94a3b8;
        font-style: italic;
      }
      
      .code-block .keyword {
        color: #c084fc;
      }
      
      .code-block .string {
        color: #4ade80;
      }
      
      .code-block .function {
        color: #60a5fa;
      }
      
      /* Citation */
      .citation-block {
        background: #f8fafc;
        border-left: 4px solid var(--color-primary);
        padding: 1.5rem;
        border-radius: 0 var(--radius) var(--radius) 0;
        margin: 2rem 0;
        font-family: 'SF Mono', 'Consolas', monospace;
        font-size: 0.9rem;
        line-height: 1.5;
        white-space: pre-wrap;
      }
      
      /* Footer */
      .site-footer {
        background: white;
        padding: 4rem 0;
        text-align: center;
        color: var(--color-muted);
        border-top: 1px solid #f1f5f9;
      }
      
      .footer-content {
        max-width: 640px;
        margin: 0 auto;
      }
      
      .footer-links {
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        margin: 1.5rem 0;
      }
      
      /* Results visualization */
      .results-visual img {
        max-width: 100%;
        height: auto;
        border-radius: var(--radius);
        box-shadow: var(--shadow-sm);
      }
      
      /* Tool visualization */
      .tool-image {
        width: 100%;
        height: auto;
        border-radius: var(--radius);
        margin: 1rem 0;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
      }
      
      .tool-image:hover {
        transform: scale(1.02);
        box-shadow: var(--shadow);
      }
      
      /* Add new hover styles */
      .visual-card {
        position: relative;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      
      .visual-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow);
      }
      
      .card-overlay {
        transition: opacity 0.3s ease;
      }
      
      .visual-card:hover .card-overlay {
        opacity: 1;
      }
      
      .feature-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      
      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow);
      }
      
      .btn {
        transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
      }
      
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
      }
      
      /* Add image zoom effect on hover */
      .feature-card .image-container {
        overflow: hidden;
      }
      
      .feature-card .image-container img {
        transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }
      
      .feature-card:hover .image-container img {
        transform: scale(1.05);
      }
      
      /* Add gradient overlay on images */
      .feature-card .image-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0) 40%);
        pointer-events: none;
        opacity: 0.7;
        transition: opacity 0.3s ease;
      }
      
      .feature-card:hover .image-overlay {
        opacity: 0.4;
      }
      
      /* Responsive styles for hero grid */
      @media (max-width: 1024px) {
        .hero-grid {
          grid-template-columns: repeat(6, 1fr);
        }
        
        .hero-grid .visual-card:nth-child(1) {
          grid-column: span 6;
        }
        
        .hero-grid .visual-card:nth-child(2) {
          grid-column: span 6;
        }
        
        .hero-grid .visual-card:nth-child(3),
        .hero-grid .visual-card:nth-child(4),
        .hero-grid .visual-card:nth-child(5) {
          grid-column: span 2;
        }
      }
      
      @media (max-width: 768px) {
        .hero-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 1rem;
        }
        
        .hero-grid .visual-card:nth-child(1),
        .hero-grid .visual-card:nth-child(2) {
          grid-column: span 2;
        }
        
        .hero-grid .visual-card:nth-child(3),
        .hero-grid .visual-card:nth-child(4),
        .hero-grid .visual-card:nth-child(5) {
          grid-column: span 1;
        }
        
        .example-content {
          grid-template-columns: 1fr;
        }
      }
      
      @media (max-width: 680px) {
        .hero-grid .visual-card:nth-child(3),
        .hero-grid .visual-card:nth-child(4),
        .hero-grid .visual-card:nth-child(5) {
          grid-column: span 2;
        }
      }

      /* Hide scrollbar but keep functionality */
      .nav-list::-webkit-scrollbar {
        display: none;
      }
      
      /* Add fading edges to indicate scrollable content */
      @media (max-width: 768px) {
        .nav-container::before,
        .nav-container::after {
          content: '';
          position: absolute;
          top: 0;
          bottom: 0;
          width: 30px;
          z-index: 2;
          pointer-events: none;
        }
        
        .nav-container::before {
          left: 0;
          background: linear-gradient(to right, white, rgba(255, 255, 255, 0));
        }
        
        .nav-container::after {
          right: 0;
          background: linear-gradient(to left, white, rgba(255, 255, 255, 0));
        }
        
        /* Larger touch targets for mobile */
        .nav-link {
          padding: 0.8rem 0.9rem !important; 
          font-size: 0.9rem !important;
        }
        
        /* More compact spacing for small screens */
        .nav-list {
          padding: 0.3rem 0 !important;
          justify-content: flex-start !important;
          padding-left: 0.5rem !important;
          scroll-behavior: smooth; /* Add smooth scrolling */
        }
        
        /* Add smooth transition for active state */
        .nav-link.active {
          transition: all 0.3s ease;
        }
      }
      
      /* Additional fixes for mobile layout */
      @media (max-width: 768px) {
        /* Fix potential overflow issues */
        .container {
          padding-left: 1rem;
          padding-right: 1rem;
          max-width: 100%;
        }
        
        /* Ensure all grids are responsive */
        [class*="grid"] {
          width: 100%;
          margin-left: 0;
          margin-right: 0;
        }
        
        /* Rules container fix */
        .rules-container {
          margin-left: -0.5rem;
          margin-right: -0.5rem;
          width: calc(100% + 1rem);
          padding-left: 0.5rem;
          padding-right: 0.5rem;
        }
      }
      
      /* Tablet layout (768px to 991px) */
      @media (min-width: 768px) and (max-width: 991px) {
        .hero-grid {
          grid-template-columns: repeat(12, 1fr) !important;
          gap: 1.5rem !important;
        }
        
        .grid-item-format,
        .grid-item-performance {
          grid-column: span 6 !important; /* Equal width on tablets */
        }
        
        .visual-card {
          height: 300px !important; /* Slightly reduced height on tablets */
        }
      }
      
      /* Mobile-specific grid layout to stack items vertically */
      @media (max-width: 767px) {
        .hero-grid {
          grid-template-columns: 1fr !important;
          gap: 2rem !important;
        }
        
        .grid-item-format,
        .grid-item-performance {
          grid-column: span 12 !important;
        }
        
        .visual-card {
          height: 250px !important; /* More compact on phones */
        }
      }

      /* Tablet and Desktop layout adjustments */
      @media (min-width: 768px) {
        .hero-grid {
          justify-content: center;
          gap: 2rem;
        }
        
        .grid-item-format,
        .grid-item-performance {
          flex: 1;
          max-width: 500px; /* Constrain width on larger screens */
        }
      }
      
      /* Mobile-specific layout adjustments */
      @media (max-width: 767px) {
        .hero-grid {
          flex-direction: column;
          align-items: center;
          gap: 2rem;
        }
        
        .grid-item-format,
        .grid-item-performance {
          width: 100%;
          max-width: 450px; /* Slightly narrower on mobile */
          margin-bottom: 0;
        }
        
        .visual-card {
          height: 280px; /* Taller on phones for better visibility */
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="site-header">
      <div class="particle-container">
        <div class="particle particle-1"></div>
        <div class="particle particle-2"></div>
        <div class="particle particle-3"></div>
      </div>
      <div class="container">
        <div class="header-content">
          <h1 class="header-title" style="font-size: 4.5rem; margin-bottom: 0.5rem; position: relative; display: inline-block; background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 50%, #ffffff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; letter-spacing: -0.02em;">
            SPaRC
          </h1>
          <p class="tagline" style="font-size: 1.2rem; max-width: 700px; margin: 0 auto 1.5rem; line-height: 1.5; color: rgba(255, 255, 255, 0.95); text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); font-weight: 400;">
            A Spatial Pathfinding and Reasoning Challenge for grounding language models in spatial cognition
          </p>
          
          <div class="header-meta" style="display: flex; justify-content: center; align-items: center; gap: 1.5rem; margin-bottom: 1.5rem; padding: 1.2rem 1.5rem; background: rgba(255, 255, 255, 0.12); border-radius: var(--radius); backdrop-filter: blur(10px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="header-stats" style="display: flex; gap: 1.5rem;">
              <div class="header-stat" style="text-align: center; position: relative;">
                <div class="stat-number" style="font-size: 2.2rem; font-weight: 700; line-height: 1; margin-bottom: 0.25rem;">1,000</div>
                <div class="stat-label" style="font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 500; opacity: 0.9;">Puzzles</div>
              </div>
              <div class="header-stat" style="text-align: center; position: relative;">
                <div class="stat-number" style="font-size: 2.2rem; font-weight: 700; line-height: 1; margin-bottom: 0.25rem;">98%</div>
                <div class="stat-label" style="font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 500; opacity: 0.9;">Human Success</div>
              </div>
              <div class="header-stat" style="text-align: center; position: relative;">
                <div class="stat-number" style="font-size: 2.2rem; font-weight: 700; line-height: 1; margin-bottom: 0.25rem;">15.8%</div>
                <div class="stat-label" style="font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 500; opacity: 0.9;">AI Success</div>
              </div>
            </div>
            
            <div class="authors" style="text-align: left; padding-left: 1.5rem; line-height: 1.6; font-size: 0.9rem;">
              <div style="font-weight: 500; margin-bottom: 0.2rem; color: rgba(255, 255, 255, 0.95);">
                Lars&nbsp;Benedikt&nbsp;Kaesberg,
                Jan&nbsp;Philip&nbsp;Wahle,
                Terry&nbsp;Ruas,
                Bela&nbsp;Gipp
              </div>
              <div style="font-size: 0.85rem; opacity: 0.8;">University of Göttingen, Germany</div>
            </div>
          </div>
          
          <div class="header-buttons" style="display: flex; gap: 1rem; justify-content: center; position: relative; z-index: 5; margin-bottom: 1rem;">
            <a href="https://huggingface.co/datasets/lkaesberg/SPaRC" class="header-btn header-btn-primary" style="position: relative; display: inline-flex; align-items: center; justify-content: center; padding: 0.8rem 1.5rem; font-weight: 600; font-size: 0.95rem; border-radius: 30px; transition: all 0.3s ease; background: #ffffff; color: var(--color-primary); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
              Get the Dataset
            </a>
            <a href="/annotate.html?url=https://huggingface.co/datasets/lkaesberg/SPaRC/raw/main/puzzle_all_test.jsonl" target="_blank" class="header-btn header-btn-secondary" style="position: relative; display: inline-flex; align-items: center; justify-content: center; padding: 0.8rem 1.5rem; font-weight: 600; font-size: 0.95rem; border-radius: 30px; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.15); color: white; backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.2);">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>
              Try Online
            </a>
            <a href="https://github.com/lkaesberg/SPaRC" target="_blank" class="header-btn header-btn-secondary" style="position: relative; display: inline-flex; align-items: center; justify-content: center; padding: 0.8rem 1.5rem; font-weight: 600; font-size: 0.95rem; border-radius: 30px; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.15); color: white; backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.2);">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
              View on GitHub
            </a>
            <a href="https://arxiv.org/abs/2505.16686" target="_blank" class="header-btn header-btn-secondary" style="position: relative; display: inline-flex; align-items: center; justify-content: center; padding: 0.8rem 1.5rem; font-weight: 600; font-size: 0.95rem; border-radius: 30px; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.15); color: white; backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.2);">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
              Read Paper
            </a>
            <a href="#citation" class="header-btn header-btn-secondary" style="position: relative; display: inline-flex; align-items: center; justify-content: center; padding: 0.8rem 1.5rem; font-weight: 600; font-size: 0.95rem; border-radius: 30px; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.15); color: white; backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.2);">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;"><path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"></path><line x1="4" y1="21" x2="20" y2="21"></line></svg>
              Cite SPaRC
            </a>
          </div>
        </div>
      </div>
      
      <div style="position: absolute; bottom: -2px; left: 0; width: 100%; z-index: 1; pointer-events: none;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 100" fill="#ffffff" preserveAspectRatio="none" style="display: block; width: 100%; height: 70px;">
          <path d="M0,32L80,42.7C160,53,320,75,480,75C640,75,800,53,960,48C1120,43,1280,53,1360,58.7L1440,64L1440,100L1360,100C1280,100,1120,100,960,100C800,100,640,100,480,100C320,100,160,100,80,100L0,100Z"></path>
        </svg>
      </div>
      
      <style>
        /* Adjust wave position on mobile */
        @media (max-width: 680px) {
          .site-header > div:last-child {
            bottom: -1px;
          }
          .site-header > div:last-child svg {
            height: 50px; /* Smaller wave on mobile */
          }
        }
      </style>
    </header>

    <!-- Navigation -->
    <div class="nav-container" style="border-bottom: 1px solid rgba(226, 232, 240, 0.8); position: sticky !important; top: 0 !important; z-index: 1000; background: white; width: 100%; will-change: transform;">
      <div class="container">
        <nav class="main-nav">
          <ul class="nav-list" style="display: flex; flex-wrap: nowrap; gap: 0.2rem; margin: 0; padding: 0.5rem 0; list-style: none; justify-content: flex-start; overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
            <li class="nav-item"><a href="#overview" class="nav-link" style="display: block; padding: 0.7rem 0.8rem; color: var(--color-text); font-weight: 500; border-radius: var(--radius-sm); transition: all 0.2s ease; font-size: 0.95rem; white-space: nowrap; min-width: 44px; text-align: center;">Overview</a></li>
            <li class="nav-item"><a href="#key-features" class="nav-link" style="display: block; padding: 0.7rem 0.8rem; color: var(--color-text); font-weight: 500; border-radius: var(--radius-sm); transition: all 0.2s ease; font-size: 0.95rem; white-space: nowrap; min-width: 44px; text-align: center;">Features</a></li>
            <li class="nav-item"><a href="#puzzle-rules" class="nav-link" style="display: block; padding: 0.7rem 0.8rem; color: var(--color-text); font-weight: 500; border-radius: var(--radius-sm); transition: all 0.2s ease; font-size: 0.95rem; white-space: nowrap; min-width: 44px; text-align: center;">Rules</a></li>
            <li class="nav-item"><a href="#example" class="nav-link" style="display: block; padding: 0.7rem 0.8rem; color: var(--color-text); font-weight: 500; border-radius: var(--radius-sm); transition: all 0.2s ease; font-size: 0.95rem; white-space: nowrap; min-width: 44px; text-align: center;">Example</a></li>
            <li class="nav-item"><a href="#leaderboard" class="nav-link" style="display: block; padding: 0.7rem 0.8rem; color: var(--color-text); font-weight: 500; border-radius: var(--radius-sm); transition: all 0.2s ease; font-size: 0.95rem; white-space: nowrap; min-width: 44px; text-align: center;">Results</a></li>
            <li class="nav-item"><a href="#tools" class="nav-link" style="display: block; padding: 0.7rem 0.8rem; color: var(--color-text); font-weight: 500; border-radius: var(--radius-sm); transition: all 0.2s ease; font-size: 0.95rem; white-space: nowrap; min-width: 44px; text-align: center;">Tools</a></li>
            <li class="nav-item"><a href="#dataset" class="nav-link" style="display: block; padding: 0.7rem 0.8rem; color: var(--color-text); font-weight: 500; border-radius: var(--radius-sm); transition: all 0.2s ease; font-size: 0.95rem; white-space: nowrap; min-width: 44px; text-align: center;">Dataset</a></li>
            <li class="nav-item"><a href="#citation" class="nav-link" style="display: block; padding: 0.7rem 0.8rem; color: var(--color-text); font-weight: 500; border-radius: var(--radius-sm); transition: all 0.2s ease; font-size: 0.95rem; white-space: nowrap; min-width: 44px; text-align: center;">Citation</a></li>
          </ul>
        </nav>
      </div>
      <style>
        /* Hide scrollbar but keep functionality */
        .nav-list::-webkit-scrollbar {
          display: none;
        }
        
        /* Add fading edges to indicate scrollable content */
        @media (max-width: 768px) {
          .nav-container::before,
          .nav-container::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 30px;
            z-index: 2;
            pointer-events: none;
          }
          
          .nav-container::before {
            left: 0;
            background: linear-gradient(to right, white, rgba(255, 255, 255, 0));
          }
          
          .nav-container::after {
            right: 0;
            background: linear-gradient(to left, white, rgba(255, 255, 255, 0));
          }
          
          /* Larger touch targets for mobile */
          .nav-link {
            padding: 0.8rem 0.9rem !important; 
            font-size: 0.9rem !important;
          }
          
          /* More compact spacing for small screens */
          .nav-list {
            padding: 0.3rem 0 !important;
            justify-content: flex-start !important;
            padding-left: 0.5rem !important;
            scroll-behavior: smooth; /* Add smooth scrolling */
          }
          
          /* Add smooth transition for active state */
          .nav-link.active {
            transition: all 0.3s ease;
          }
        }
        
        /* Additional fixes for mobile layout */
        @media (max-width: 768px) {
          /* Fix potential overflow issues */
          .container {
            padding-left: 1rem;
            padding-right: 1rem;
            max-width: 100%;
          }
          
          /* Ensure all grids are responsive */
          [class*="grid"] {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
          }
          
          /* Rules container fix */
          .rules-container {
            margin-left: -0.5rem;
            margin-right: -0.5rem;
            width: calc(100% + 1rem);
            padding-left: 0.5rem;
            padding-right: 0.5rem;
          }
        }
      </style>
      </div>

    <!-- Main Content -->
    <main class="main-content" style="width: 100%; overflow-x: hidden; max-width: 100vw; position: relative; z-index: 1;">
      <div class="container">
        <!-- Hero Grid -->
        <div class="hero-grid" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 2rem; margin-bottom: 3rem; width: 100%; max-width: 100%; overflow: hidden;">
          <!-- Main visualization - keep this important image -->
          <div class="grid-item-format" style="flex: 1; max-width: 500px; min-width: 300px; display: flex; flex-direction: column; box-shadow: var(--shadow); border-radius: var(--radius); overflow: hidden;">
            <div class="visual-card" style="height: 360px; border-radius: var(--radius) var(--radius) 0 0; overflow: hidden; position: relative;">
              <img src="graphics/images/teaser.png" alt="SPaRC Grid Visualization" style="width: 100%; height: 100%; object-fit: contain; background-color: #ffffff; padding: 1rem;" />
            </div>
            <div style="padding: 0.75rem; background: rgba(99, 102, 241, 0.95); color: white; font-weight: 500; text-align: center; border-radius: 0 0 var(--radius) var(--radius);">
              Grid Format
            </div>
          </div>
          
          <!-- Performance chart - keep this key visualization -->
          <div class="grid-item-performance" style="grid-column: span 7; display: flex; flex-direction: column; box-shadow: var(--shadow); border-radius: var(--radius); overflow: hidden;">
            <div class="visual-card" style="height: 360px; border-radius: var(--radius) var(--radius) 0 0; overflow: hidden; position: relative;">
              <img src="graphics/figure2_solve_rates.png" alt="Model Performance Comparison" style="width: 100%; height: 100%; object-fit: contain; background-color: #ffffff; padding: 0.5rem;" />
            </div>
            <div style="padding: 0.75rem; background: rgba(16, 185, 129, 0.95); color: white; font-weight: 500; text-align: center; border-radius: 0 0 var(--radius) var(--radius);">
              Performance
            </div>
          </div>
          </div>
          
        <style>
          /* Mobile-specific grid layout to stack items vertically */
          @media (max-width: 767px) {
            .hero-grid {
              grid-template-columns: 1fr !important;
              gap: 2rem !important;
            }
            
            .grid-item-format,
            .grid-item-performance {
              grid-column: span 12 !important;
              margin-bottom: 0 !important;
            }
            
            .visual-card {
              height: 280px !important; /* Taller on phones for better visibility */
            }
          }
        </style>

        <!-- Key Stats -->
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin: 1rem 0 4rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 2rem; border-radius: var(--radius-lg);">
          <div class="stat-card" style="text-align: center; background: white; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: var(--transition); padding: 2rem; border-top: 4px solid var(--color-primary);">
            <div style="font-size: 2.5rem; font-weight: 700; color: var(--color-primary); line-height: 1; margin-bottom: 0.5rem;">1,000</div>
            <div style="color: var(--color-text); font-weight: 500; font-size: 1.1rem;">Unique Puzzles</div>
          </div>
          <div class="stat-card" style="text-align: center; background: white; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: var(--transition); padding: 2rem; border-top: 4px solid #10b981;">
            <div style="font-size: 2.5rem; font-weight: 700; color: #10b981; line-height: 1; margin-bottom: 0.5rem;">98%</div>
            <div style="color: var(--color-text); font-weight: 500; font-size: 1.1rem;">Human Success Rate</div>
          </div>
          <div class="stat-card" style="text-align: center; background: white; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: var(--transition); padding: 2rem; border-top: 4px solid var(--color-accent);">
            <div style="font-size: 2.5rem; font-weight: 700; color: var(--color-accent); line-height: 1; margin-bottom: 0.5rem;">15.8%</div>
            <div style="color: var(--color-text); font-weight: 500; font-size: 1.1rem;">Best AI Performance</div>
          </div>
          <div class="stat-card" style="text-align: center; background: white; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: var(--transition); padding: 2rem; border-top: 4px solid #7c3aed;">
            <div style="font-size: 2.5rem; font-weight: 700; color: #7c3aed; line-height: 1; margin-bottom: 0.5rem;">15+</div>
            <div style="color: var(--color-text); font-weight: 500; font-size: 1.1rem;">Steps Per Solution</div>
          </div>
        </div>

        <!-- Overview Section -->
        <section id="overview" class="section">
          <div class="section-header">
            <h2 class="section-title">Overview</h2>
          </div>
        <p>
          Existing multi‑step reasoning benchmarks often conflate symbolic tasks
          with surface‑level linguistic pattern matching, leaving fundamental
          spatial reasoning abilities under‑explored. We introduce <strong>SPaRC</strong>, a
          dataset of 1,000 two‑dimensional grid puzzles that require joint
          <em>path‑planning</em>, <em>rule satisfaction</em>, and <em>numeric‑geometric
            arithmetic</em>. Humans solve 98% of puzzles in &lt; 20 seconds on
          average, whereas state‑of‑the‑art language‑vision models achieve only
            1–16% accuracy—underscoring a significant reasoning gap.
        </p>
      </section>

        <!-- Key Features Section -->
        <section id="key-features" class="section">
          <div class="section-header">
            <h2 class="section-title">Key Features</h2>
          </div>
          <div class="features-grid">
            <div class="feature-card">
              <h3>Multi‑Constraint Problem Solving</h3>
              <p>Puzzles require simultaneously satisfying multiple spatial constraints, forcing models to integrate various rules (counting, segregation, shape logic) while planning a single path. Wrong steps can lead to irreversible errors, requiring careful hypothesis revision and deep abstract reasoning.</p>
            </div>
            <div class="feature-card">
              <h3>Joint Planning and Pathfinding</h3>
              <p>Tasks demand step-by-step planning combined with pathfinding and logic skills. Solvers must understand rule interactions, perform long-term planning, and navigate through spatial constraints—a core human ability that modern AI systems struggle with.</p>
            </div>
            <div class="feature-card">
              <h3>Significant Human-AI Performance Gap</h3>
              <p>Humans solve 98% of puzzles easily (including 94.5% of the hardest level 5 puzzles), while state-of-the-art reasoning models achieve only 15.8% accuracy overall and just 1.1% on difficult puzzles—revealing fundamental limitations in current AI spatial reasoning.</p>
            </div>
            </div>
      </section>

        <!-- Puzzle Rules Section -->
        <section id="puzzle-rules" class="section">
          <div class="section-header">
            <h2 class="section-title">Puzzle Rules</h2>
            </div>
          
          <div class="rules-container" style="display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 1rem; padding-bottom: 1rem; -webkit-overflow-scrolling: touch; margin-bottom: 2rem; justify-content: flex-start; width: 100%; max-width: 100vw; margin-left: 0; margin-right: 0;">
            <!-- Rule 1: Dots -->
            <div class="rule-item" style="flex: 1; min-width: 100px; text-align: center; cursor: pointer; background: white; padding: 1rem 0.5rem; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: all 0.2s ease;" onclick="showRule(0)">
              <div class="rule-icon" style="margin-bottom: 0.5rem; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.75rem; background: white; overflow: hidden;">
                <img src="graphics/images/rules/dot.png" alt="Dots Rule" style="width: 145%; height: 145%; object-fit: cover;">
            </div>
              <div class="rule-title" style="font-weight: 600; font-size: 0.85rem; line-height: 1.2;">Dots</div>
          </div>
            
            <!-- Rule 2: Gaps -->
            <div class="rule-item" style="flex: 1; min-width: 100px; text-align: center; cursor: pointer; background: white; padding: 1rem 0.5rem; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: all 0.2s ease;" onclick="showRule(1)">
              <div class="rule-icon" style="margin-bottom: 0.5rem; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.75rem; background: white; overflow: hidden;">
                <img src="graphics/images/rules/gap.png" alt="Gaps Rule" style="width: 145%; height: 145%; object-fit: cover;">
              </div>
              <div class="rule-title" style="font-weight: 600; font-size: 0.85rem; line-height: 1.2;">Gaps</div>
            </div>
            
            <!-- Rule 3: Stones -->
            <div class="rule-item" style="flex: 1; min-width: 100px; text-align: center; cursor: pointer; background: white; padding: 1rem 0.5rem; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: all 0.2s ease;" onclick="showRule(2)">
              <div class="rule-icon" style="margin-bottom: 0.5rem; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.75rem; background: white; overflow: hidden;">
                <img src="graphics/images/rules/stone.png" alt="Stones Rule" style="width: 145%; height: 145%; object-fit: cover;">
              </div>
              <div class="rule-title" style="font-weight: 600; font-size: 0.85rem; line-height: 1.2;">Stones</div>
            </div>
            
            <!-- Rule 4: Stars -->
            <div class="rule-item" style="flex: 1; min-width: 100px; text-align: center; cursor: pointer; background: white; padding: 1rem 0.5rem; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: all 0.2s ease;" onclick="showRule(3)">
              <div class="rule-icon" style="margin-bottom: 0.5rem; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.75rem; background: white; overflow: hidden;">
                <img src="graphics/images/rules/star.png" alt="Stars Rule" style="width: 145%; height: 145%; object-fit: cover;">
              </div>
              <div class="rule-title" style="font-weight: 600; font-size: 0.85rem; line-height: 1.2;">Stars</div>
            </div>
            
            <!-- Rule 5: Triangles -->
            <div class="rule-item" style="flex: 1; min-width: 100px; text-align: center; cursor: pointer; background: white; padding: 1rem 0.5rem; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: all 0.2s ease;" onclick="showRule(4)">
              <div class="rule-icon" style="margin-bottom: 0.5rem; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.75rem; background: white; overflow: hidden;">
                <img src="graphics/images/rules/triangle.png" alt="Triangles Rule" style="width: 145%; height: 145%; object-fit: cover;">
              </div>
              <div class="rule-title" style="font-weight: 600; font-size: 0.85rem; line-height: 1.2;">Triangles</div>
            </div>
            
            <!-- Rule 6: Polyominoes -->
            <div class="rule-item" style="flex: 1; min-width: 100px; text-align: center; cursor: pointer; background: white; padding: 1rem 0.5rem; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: all 0.2s ease;" onclick="showRule(5)">
              <div class="rule-icon" style="margin-bottom: 0.5rem; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.75rem; background: white; overflow: hidden;">
                <img src="graphics/images/rules/poly.png" alt="Polyominoes Rule" style="width: 145%; height: 145%; object-fit: cover;">
              </div>
              <div class="rule-title" style="font-weight: 600; font-size: 0.85rem; line-height: 1.2;">Polyominoes</div>
            </div>
            
            <!-- Rule 7: Ylop -->
            <div class="rule-item" style="flex: 1; min-width: 100px; text-align: center; cursor: pointer; background: white; padding: 1rem 0.5rem; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: all 0.2s ease;" onclick="showRule(6)">
              <div class="rule-icon" style="margin-bottom: 0.5rem; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.75rem; background: white; overflow: hidden;">
                <img src="graphics/images/rules/ylop.png" alt="Ylop Rule" style="width: 145%; height: 145%; object-fit: cover;">
              </div>
              <div class="rule-title" style="font-weight: 600; font-size: 0.85rem; line-height: 1.2;">Ylop</div>
            </div>
          </div>
          
          <!-- Rule Details Container -->
          <div id="ruleDetails" class="rule-details" style="background: white; border-radius: var(--radius); box-shadow: var(--shadow); padding: 2rem; margin-bottom: 2rem; display: block;">
            <div class="rule-header" style="display: flex; align-items: center; margin-bottom: 1.5rem;">
              <div id="detailIcon" class="detail-icon" style="background: rgba(99, 102, 241, 0.1); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1.5rem; overflow: hidden;">
                <img src="graphics/images/rules/dot.png" alt="Dots Rule" style="width: 145%; height: 145%; object-fit: cover;">
              </div>
              <div>
                <h3 id="detailTitle" class="detail-title" style="margin: 0 0 0.25rem; font-size: 1.5rem; color: var(--color-primary);">
                  Item Collection
                </h3>
                <div id="detailSubtitle" class="detail-subtitle" style="font-size: 1rem; color: var(--color-muted); font-weight: 400;">
                  Dots
                </div>
              </div>
            </div>
            <p id="detailDescription" class="detail-description" style="font-size: 1.1rem; line-height: 1.6; margin: 0;">
              The solution path needs to pass through every dot.
            </p>
          </div>
          
          <script>
            // Rule definitions
            const rules = [
              {
                title: 'Item Collection',
                subtitle: 'Dots',
                image: 'graphics/images/rules/dot.png',
                description: 'The solution path needs to pass through every dot.'
              },
              {
                title: 'Path Breaks',
                subtitle: 'Gaps',
                image: 'graphics/images/rules/gap.png',
                description: 'The solution path cannot go through any edge segment containing a gap. Gaps act as local barriers.'
              },
              {
                title: 'Color Separation',
                subtitle: 'Stones',
                image: 'graphics/images/rules/stone.png',
                description: 'The solution path must be drawn to separate stones of different colors. All stones located within any single enclosed region must be of the same color.'
              },
              {
                title: 'Pairing',
                subtitle: 'Stars',
                image: 'graphics/images/rules/star.png',
                description: 'Each star must share its region with exactly one other symbol of the same color. No unpaired or triplet stars are allowed in a region.'
              },
              {
                title: 'Edge Count',
                subtitle: 'Triangles',
                image: 'graphics/images/rules/triangle.png',
                description: 'The solution path must touch the number of edges shown by the triangles in the cell, e.g., two triangles mean the path must touch exactly two edges of that cell.'
              },
              {
                title: 'Shape Fitting',
                subtitle: 'Polyominoes',
                image: 'graphics/images/rules/poly.png',
                description: 'If a cell contains a polyomino (poly), the solution path must enclose a region that matches its exact shape and area. The region must not rotate or mirror the poly. Multiple polys can share a region if their shapes fit without overlapping.'
              },
              {
                title: 'Shape Subtraction',
                subtitle: 'Ylop',
                image: 'graphics/images/rules/ylop.png',
                description: 'A ylop must be enclosed in the same region as one or more polys. Its shape and area subtract from the total required by the polys. If a ylop cancels out a poly exactly, that pair imposes no constraint.'
              }
            ];
            
            // Function to show rule details
            function showRule(index) {
              // Get the rule details
              const rule = rules[index];
              
              // Update the details
              document.getElementById('detailIcon').innerHTML = `<img src="${rule.image}" alt="${rule.subtitle} Rule" style="width: 145%; height: 145%; object-fit: cover;">`;
              document.getElementById('detailTitle').textContent = rule.title;
              document.getElementById('detailSubtitle').textContent = rule.subtitle;
              document.getElementById('detailDescription').textContent = rule.description;
              
              // Update highlighted item state
              const items = document.querySelectorAll('.rule-item');
              items.forEach((item, i) => {
                if (i === index) {
                  item.style.transform = 'translateY(-5px)';
                  item.style.boxShadow = 'var(--shadow)';
                  item.style.background = 'rgba(99, 102, 241, 0.05)';
                } else {
                  item.style.transform = '';
                  item.style.boxShadow = 'var(--shadow-sm)';
                  item.style.background = 'white';
                }
              });
            }
            
            // Initialize with first rule
            document.addEventListener('DOMContentLoaded', function() {
              const firstItem = document.querySelector('.rule-item');
              if (firstItem) {
                firstItem.style.transform = 'translateY(-5px)';
                firstItem.style.boxShadow = 'var(--shadow)';
                firstItem.style.background = 'rgba(99, 102, 241, 0.05)';
              }
            });
          </script>
      </section>

        <!-- Example Section -->
        <section id="example" class="section">
          <div class="section-header">
            <h2 class="section-title">Example Puzzle</h2>
          </div>
          <div class="card" style="background: linear-gradient(to bottom, #ffffff, #f8fafc); overflow: hidden; border: none; box-shadow: var(--shadow);">
            <div class="example-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
              <div>
                <h3 style="margin-top: 0; color: var(--color-primary);">Puzzle Description</h3>
                <p style="font-style: italic; color: var(--color-text); margin-bottom: 2rem;">
                  "Start at the marked position. Navigate through the grid while adhering to the rules defined by the colored elements. Find a valid path to the exit point while satisfying all constraints."
                </p>
                
                <div style="margin-bottom: 2rem;">
                  <div class="puzzle-controls" style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                    <button id="show-solution-btn" class="btn btn-accent" style="display: flex; align-items: center; gap: 0.5rem;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4M12 8h.01"></path></svg>
                      Show Solution
                    </button>
                    <button id="randomize-puzzle-btn" class="btn" style="display: flex; align-items: center; gap: 0.5rem;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.57-8.38"></path></svg>
                      Random Puzzle
                    </button>
                  </div>
                </div>
                
                <div class="puzzle-stats" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; background: #f1f5f9; padding: 1.5rem; border-radius: var(--radius-sm);">
                  <div class="stat-item">
                    <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-muted); margin-bottom: 0.25rem;">Puzzle ID</div>
                    <div id="puzzle-id" style="font-size: 1rem; font-weight: 600; font-family: 'SF Mono', monospace;"></div>
                  </div>
                  <div class="stat-item">
                    <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-muted); margin-bottom: 0.25rem;">Difficulty</div>
                    <div id="puzzle-difficulty" style="font-size: 1rem; font-weight: 600;"></div>
                  </div>
                  <div class="stat-item">
                    <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-muted); margin-bottom: 0.25rem;">Grid Size</div>
                    <div id="puzzle-grid-size" style="font-size: 1rem; font-weight: 600;"></div>
                  </div>
                  <div class="stat-item">
                    <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-muted); margin-bottom: 0.25rem;">Solution Length</div>
                    <div id="puzzle-path-length" style="font-size: 1rem; font-weight: 600;"></div>
                  </div>
                </div>
              </div>
              
              <div style="background: linear-gradient(135deg, #1e293b 0%, #111827 100%); border-radius: var(--radius); padding: 1.5rem; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 10px 25px -5px rgba(17, 24, 39, 0.5); height: 100%;">
                <!-- Glow effects -->
                <div style="position: absolute; width: 300px; height: 300px; background: rgba(16, 185, 129, 0.05); border-radius: 50%; filter: blur(40px);"></div>
                <div style="position: absolute; width: 250px; height: 250px; background: rgba(99, 102, 241, 0.05); border-radius: 50%; filter: blur(40px);"></div>
                
                <!-- Puzzle container with adaptive dimensions -->
                <div style="display: flex; align-items: center; justify-content: center; width: 100%; min-height: 280px; flex-grow: 1; max-height: 80vh; overflow: visible; position: relative;">
                  <div id="puzzle-container" style="width: 100%; height: 100%; position: relative; display: flex; align-items: center; justify-content: center; max-width: 450px; max-height: 450px;">
                    <svg id="puzzle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500" style="width: 100%; height: 100%; filter: drop-shadow(0 10px 15px rgba(0, 0, 0, 0.3));"></svg>
                    
                    <!-- Interactive overlay indicator -->
                    <div id="puzzle-interaction-hint" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.5); border-radius: var(--radius); backdrop-filter: blur(2px); cursor: pointer; z-index: 10; transition: opacity 0.3s ease-in-out;">
                      <div class="pulse-circle" style="position: relative; width: 80px; height: 80px; margin-bottom: 20px;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border-radius: 50%; background: rgba(255, 255, 255, 0.2); animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;"></div>
                        <div style="position: absolute; top: 15px; left: 15px; right: 15px; bottom: 15px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; animation: pulse-dot 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;">
                        </div>
                      </div>
                      <p style="color: white; font-weight: 500; text-align: center; margin: 0; padding: 0 20px; font-size: 1.1rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                        Click to interact
                      </p>
                    </div>
                  </div>
                </div>
                
                <!-- Information text -->
                <div style="margin-top: 1.5rem; text-align: center; color: white; font-size: 0.9rem; width: 100%;">
                  <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(255, 255, 255, 0.1); padding: 0.5rem 1rem; border-radius: 20px; backdrop-filter: blur(5px);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4M12 8h.01"></path></svg>
                    <span>Click "Show Solution" to visualize the optimal path</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <style>
            /* Responsive layout for the example section */
            @media (max-width: 768px) {
              .example-content {
                grid-template-columns: 1fr !important;
              }
              
              .puzzle-controls {
                flex-wrap: wrap;
                justify-content: center;
              }
              
              .puzzle-controls button {
                width: 100%;
              }
              
              #puzzle-container {
                min-height: 280px;
                max-height: 400px;
                margin: 1rem auto;
              }
            }
            
            /* Finer adjustments for smaller screens */
            @media (max-width: 680px) {
              .puzzle-stats {
                grid-template-columns: 1fr !important;
                padding: 1rem !important;
              }
              
              #puzzle-container {
                min-height: 250px;
                max-height: 350px;
              }
              
              .card {
                padding: 1rem !important;
              }
            }
            
            /* Animation for the interaction hint */
            @keyframes pulse-ring {
              0% {
                transform: scale(0.8);
                opacity: 0.8;
              }
              50% {
                transform: scale(1.2);
                opacity: 0.3;
              }
              100% {
                transform: scale(0.8);
                opacity: 0.8;
              }
            }
            
            @keyframes pulse-dot {
              0% {
                transform: scale(0.9);
              }
              50% {
                transform: scale(1);
              }
              100% {
                transform: scale(0.9);
              }
            }
          </style>
      </section>

 

        <!-- Leaderboard Section -->
        <section id="leaderboard" class="section">
          <div class="section-header">
            <h2 class="section-title">Leaderboard</h2>
          </div>
          <p>
            Model performance on SPaRC puzzles by difficulty level. Performance generally decreases sharply as difficulty increases.
          </p>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Model</th>
                  <th>All</th>
                  <th>Level 1</th>
                  <th>Level 2</th>
                  <th>Level 3</th>
                  <th>Level 4</th>
                  <th>Level 5</th>
                </tr>
              </thead>
              <tbody>
                <tr class="human-row" style="background-color: rgba(16, 185, 129, 0.1);">
                  <td><strong>Human</strong></td>
                  <td>98.0%</td>
                  <td>100.0%</td>
                  <td>100.0%</td>
                  <td>100.0%</td>
                  <td>94.4%</td>
                  <td>94.5%</td>
                </tr>
                <tr style="background-color: #f8fafc;">
                  <td colspan="7"><strong>Reasoning Models</strong></td>
                </tr>
                <tr>
                  <td><img src="graphics/images/logos/openai.png" alt="OpenAI" width="16px" style="vertical-align: middle; margin-right: 6px;"> o4-mini</td>
                  <td><strong>15.8%</strong></td>
                  <td><strong>47.7%</strong></td>
                  <td><strong>19.5%</strong></td>
                  <td><strong>10.7%</strong></td>
                  <td><strong>1.2%</strong></td>
                  <td><strong>1.1%</strong></td>
                </tr>
                <tr>
                  <td><img src="graphics/images/logos/openai.png" alt="OpenAI" width="16px" style="vertical-align: middle; margin-right: 6px;"> o3-mini</td>
                  <td>8.2%</td>
                  <td>29.1%</td>
                  <td>10.2%</td>
                  <td>2.5%</td>
                  <td><strong>1.2%</strong></td>
                  <td>0.0%</td>
                </tr>
                <tr>
                  <td><img src="graphics/images/logos/qwen.png" alt="Qwen" width="16px" style="vertical-align: middle; margin-right: 6px;"> QwQ 32B</td>
                  <td>5.8%</td>
                  <td>20.9%</td>
                  <td>5.9%</td>
                  <td>2.5%</td>
                  <td><strong>1.2%</strong></td>
                  <td>0.0%</td>
                </tr>
                <tr>
                  <td><img src="graphics/images/logos/deepseek.png" alt="DeepSeek" width="16px" style="vertical-align: middle; margin-right: 6px;"> R1 70B</td>
                  <td>4.0%</td>
                  <td>17.4%</td>
                  <td>2.5%</td>
                  <td>1.7%</td>
                  <td>0.0%</td>
                  <td>0.0%</td>
                </tr>
                <tr style="background-color: #f8fafc;">
                  <td colspan="7"><strong>Instruction Models</strong></td>
                </tr>
                <tr>
                  <td><img src="graphics/images/logos/openai.png" alt="OpenAI" width="16px" style="vertical-align: middle; margin-right: 6px;"> GPT-4.1</td>
                  <td>1.6%</td>
                  <td>7.0%</td>
                  <td>0.8%</td>
                  <td>0.8%</td>
                  <td>0.0%</td>
                  <td>0.0%</td>
                </tr>
                <tr>
                  <td><img src="graphics/images/logos/google.png" alt="Google" width="16px" style="vertical-align: middle; margin-right: 6px;"> Gemma-3 27B</td>
                  <td>1.2%</td>
                  <td>3.5%</td>
                  <td>0.8%</td>
                  <td>0.8%</td>
                  <td>0.0%</td>
                  <td><strong>1.1%</strong></td>
                </tr>
                <tr>
                  <td><img src="graphics/images/logos/qwen.png" alt="Qwen" width="16px" style="vertical-align: middle; margin-right: 6px;"> Qwen 2.5 72B</td>
                  <td>0.4%</td>
                  <td>0.0%</td>
                  <td>1.7%</td>
                  <td>0.0%</td>
                  <td>0.0%</td>
                  <td>0.0%</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Keep just this one key visualization image -->
          <div style="text-align: center; margin: 2rem 0; display: none;">
            <img src="graphics/figure_radar_error_types_selected.png" alt="Model Performance Comparison" style="max-width: 700px; width: 100%; border-radius: var(--radius); box-shadow: var(--shadow-sm);" />
            <p class="caption" style="margin-top: 0.5rem; color: var(--color-muted); font-size: 0.9rem;">
              Figure: Error analysis by model type and reasoning category
            </p>
          </div>

          <!-- Error Analysis Figure - Dedicated section with improved styling -->
          <div style="margin: 3rem 0; display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem; width: 100%; max-width: 100%; overflow-x: hidden;">
            <!-- Radar Plot Container -->
            <div style="background: white; border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; display: flex; flex-direction: column; height: 100%; max-width: 100%;">
            <div style="background: linear-gradient(to right, rgba(99, 102, 241, 0.08), rgba(16, 185, 129, 0.08)); padding: 1.5rem; border-bottom: 1px solid #f1f5f9;">
                <h3 style="margin: 0; color: var(--color-text); font-size: 1.4rem;">Error Patterns by Model Type</h3>
                <p style="margin: 0.5rem 0 0; color: var(--color-muted); font-size: 1rem;">Radar chart showing different failure modes</p>
            </div>
            
              <div style="padding: 1.5rem; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; max-width: 100%;">
                <div style="flex-grow: 1; display: flex; align-items: center; justify-content: center; width: 100%; max-width: 100%;">
                  <img src="graphics/figure_radar_error_types_seaborn.png" alt="Error Analysis by Model Type" style="max-width: 100%; height: auto; border-radius: var(--radius-sm); box-shadow: var(--shadow-sm);" />
                </div>
                <p style="margin-top: 1.5rem; color: var(--color-muted); font-size: 0.9rem; text-align: center;">
                  Error patterns differ across model types, with reasoning models showing better performance on baseline spatial tasks but struggling with complex rule interactions.
                </p>
              </div>
            </div>
            
            <!-- Reasoning Example Container -->
            <div style="background: white; border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; display: flex; flex-direction: column; height: 100%; max-width: 100%;">
              <div style="background: linear-gradient(to right, rgba(244, 63, 94, 0.08), rgba(99, 102, 241, 0.08)); padding: 1.5rem; border-bottom: 1px solid #f1f5f9;">
                <h3 style="margin: 0; color: var(--color-text); font-size: 1.4rem;">Reasoning Analysis Example</h3>
                <p style="margin: 0.5rem 0 0; color: var(--color-muted); font-size: 1rem;">Case study of model reasoning failure</p>
            </div>
              
              <div style="padding: 1.5rem; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; max-width: 100%;">
                <div style="flex-grow: 1; display: flex; align-items: center; justify-content: center; width: 100%; max-width: 100%;">
                  <img src="graphics/reasoning.png" alt="Reasoning Analysis Example" style="max-width: 100%; height: auto; border-radius: var(--radius-sm); box-shadow: var(--shadow-sm);" />
          </div>
                <p style="margin-top: 1.5rem; color: var(--color-muted); font-size: 0.9rem; text-align: center;">
                  Analysis of puzzle 80a59619e323acba with an incorrect solution attempt by DeepSeek R1 Llama 70B. The model tends to commit to a sequence of reasoning steps without thoroughly validating each one, leading to careless mistakes.
                </p>
              </div>
            </div>
          </div>

          <style>
            @media (max-width: 850px) {
              [style*="grid-template-columns: repeat(auto-fit, minmax(400px, 1fr))"] {
                grid-template-columns: 1fr !important;
              }
            }
            
            @media (max-width: 600px) {
              [style*="grid-template-columns: repeat(auto-fit, minmax(400px, 1fr))"] {
                grid-template-columns: 1fr !important;
              }
              
              [style*="minmax(400px, 1fr)"] > div {
                width: 100% !important;
                max-width: 100% !important;
                padding: 1rem !important;
              }
              
              [style*="minmax(400px, 1fr)"] h3 {
                font-size: 1.2rem !important;
              }
            }
          </style>
      </section>

        <!-- Tools Section -->
        <section id="tools" class="section">
          <div class="section-header">
            <h2 class="section-title">Tools &amp; Resources</h2>
          </div>
          <div class="features-grid" style="grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem;">
            <!-- Puzzle Visualizer -->
            <div class="feature-card" style="background: white; border-radius: var(--radius); padding: 1.5rem; overflow: hidden; box-shadow: var(--shadow); border: none; transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); display: flex; flex-direction: column;">
              <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                <div style="width: 48px; height: 48px; border-radius: 50%; background: rgba(99, 102, 241, 0.1); display: flex; align-items: center; justify-content: center; margin-right: 1rem;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                </div>
                <div>
                  <h3 style="margin: 0; font-size: 1.25rem; color: var(--color-text);">Puzzle Visualizer</h3>
                  <div style="font-size: 0.85rem; color: var(--color-primary); font-weight: 500;">Interactive Tool</div>
                </div>
              </div>
              
              <div style="background: #f8fafc; border-radius: var(--radius-sm); padding: 1rem; margin-bottom: 1.5rem; border-left: 3px solid var(--color-primary); font-size: 0.9rem; color: var(--color-text); opacity: 0.9; flex-grow: 1;">
                <p>Solve any puzzle with our interactive visualization tool. Allows examining solutions, rules, and constraints.</p>
              </div>
              
              <a href="/visualizer.html" class="btn" style="width: 100%; padding: 0.7rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-top: auto;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>
                Open Visualizer
              </a>
            </div>
            
            <!-- Annotation Interface -->
            <div class="feature-card" style="background: white; border-radius: var(--radius); padding: 1.5rem; overflow: hidden; box-shadow: var(--shadow); border: none; transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); display: flex; flex-direction: column;">
              <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                <div style="width: 48px; height: 48px; border-radius: 50%; background: rgba(244, 63, 94, 0.1); display: flex; align-items: center; justify-content: center; margin-right: 1rem;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                </div>
                <div>
                  <h3 style="margin: 0; font-size: 1.25rem; color: var(--color-text);">Annotation Interface</h3>
                  <div style="font-size: 0.85rem; color: var(--color-accent); font-weight: 500;">Research Tool</div>
                </div>
              </div>
              
              <div style="background: #f8fafc; border-radius: var(--radius-sm); padding: 1rem; margin-bottom: 1.5rem; border-left: 3px solid var(--color-accent); font-size: 0.9rem; color: var(--color-text); opacity: 0.9; flex-grow: 1;">
                <p>Use our annotation interface to label puzzle samples and analyze human capabilities compared to AI models.</p>
              </div>
              
              <a href="/annotate.html" class="btn" style="width: 100%; padding: 0.7rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-top: auto;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                Start Annotating
              </a>
            </div>
            
            <!-- Result Analyser (Coming Soon) -->
            <div class="feature-card" style="background: white; border-radius: var(--radius); padding: 1.5rem; overflow: hidden; box-shadow: var(--shadow); border: none; transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); display: flex; flex-direction: column;">
              <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                <div style="width: 48px; height: 48px; border-radius: 50%; background: rgba(16, 185, 129, 0.1); display: flex; align-items: center; justify-content: center; margin-right: 1rem;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20v-6M9 17h6"></path><path d="M10 20H3a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h7M14 20h7a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-7"></path><path d="M21 14H3"></path><path d="M21 6H3"></path></svg>
                </div>
                <div>
                  <h3 style="margin: 0; font-size: 1.25rem; color: var(--color-text);">Result Analyser</h3>
                  <div style="font-size: 0.85rem; color: #10b981; font-weight: 500;">Coming Soon</div>
                </div>
              </div>
              
              <div style="background: #f8fafc; border-radius: var(--radius-sm); padding: 1rem; margin-bottom: 1.5rem; border-left: 3px solid #10b981; font-size: 0.9rem; color: var(--color-text); opacity: 0.9; flex-grow: 1;">
                <p>Analyze model performance patterns and compare reasoning strategies across different AI systems to identify key areas for improvement.</p>
              </div>
              
              <button disabled class="btn" style="width: 100%; padding: 0.7rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-top: auto; opacity: 0.7; cursor: not-allowed;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M12 6v6l4 2"></path></svg>
                Coming Soon
              </button>
            </div>
          </div>
      </section>

             <!-- Dataset Section -->
             <section id="dataset" class="section">
              <div class="section-header">
                <h2 class="section-title">Dataset</h2>
              </div>
              <div style="display: flex; align-items: center; margin-bottom: 1.5rem; background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(99, 102, 241, 0.03) 100%); padding: 1.5rem; border-radius: var(--radius);">
                <div style="flex: 1;">
                  <p style="font-size: 1.1rem; line-height: 1.5; margin: 0;">
                    The SPaRC dataset contains 1,000 spatial reasoning puzzles with the complete "all" set 
                    available on <a href="https://huggingface.co/datasets/lkaesberg/SPaRC" style="font-weight: 500; text-decoration: underline;" target="_blank">HuggingFace</a>.
                  </p>
                </div>
                <div style="margin-left: 2rem;">
                  <a href="https://huggingface.co/datasets/lkaesberg/SPaRC" target="_blank" style="display: inline-flex; align-items: center; text-decoration: none; color: var(--color-primary); font-weight: 500;">
                    <img src="https://huggingface.co/datasets/huggingface/brand-assets/resolve/main/hf-logo.svg" alt="HuggingFace" style="height: 32px; margin-right: 0.75rem;">
                    <span>Browse on HuggingFace</span>
              </a>
            </div>
          </div>
              
              <div class="card" style="background: #1e293b; color: #e2e8f0; box-shadow: var(--shadow); overflow: hidden; padding: 0;">
                <div style="background: rgba(255, 255, 255, 0.1); padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center;">
                    <img src="https://huggingface.co/datasets/huggingface/brand-assets/resolve/main/hf-logo.svg" alt="HuggingFace" style="height: 24px; margin-right: 0.75rem;">
                    <h4 style="margin: 0; color: white; font-size: 1.1rem;">HuggingFace Usage</h4>
                  </div>
                  <div>
                    <span style="font-size: 0.8rem; opacity: 0.7;">Python</span>
                  </div>
                </div>
                <div class="code-block" style="margin: 0; border-radius: 0; padding: 1.5rem; background: transparent;"># Install and import
pip install datasets
from datasets import load_dataset

# Login using e.g. `huggingface-cli login` to access this dataset
ds = load_dataset("lkaesberg/SPaRC", "all", split="test")

# Access puzzle data
puzzle = ds[0]
print(puzzle["id"])                # Puzzle identifier
print(puzzle["difficulty_level"])  # Difficulty (1-5)
print(puzzle["grid_size"])         # Grid dimensions</div>
          </div>
      </section>

        <!-- Citation Section -->
        <section id="citation" class="section">
          <div class="section-header">
            <h2 class="section-title">Citation</h2>
          </div>
          <div class="citation-block">@article{kaesberg2025sparc,
  title     = {SPaRC: A Spatial Pathfinding Reasoning Challenge},
  author    = {Kaesberg, Lars Benedikt and Wahle, Jan Philip and Ruas, Terry and Gipp, Bela},
  year      = {2025},
  url       = {https://huggingface.co/datasets/lkaesberg/SPaRC}
}</div>
      </section>

        <!-- Contact Section -->
        <section id="contact" class="section">
          <div class="section-header">
            <h2 class="section-title">Contact</h2>
          </div>
          <div class="card" style="text-align: center;">
            <p>For questions, feedback, or collaboration opportunities:</p>
            <p><a href="mailto:l.kaesberg@uni-goettingen.de">l.kaesberg@uni-goettingen.de</a></p>
          </div>
      </section>
      </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="container">
        <div class="footer-content">
          <p>Dataset Released under <a href="https://creativecommons.org/licenses/by/4.0/">CC‑BY‑4.0</a> · © 2025 SPaRC Authors</p>
          <div class="footer-links">
            <a href="https://github.com/lkaesberg/SPaRC">GitHub</a>
            <a href="https://huggingface.co/datasets/lkaesberg/SPaRC">HuggingFace</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Hidden elements required by the puzzle engine -->
    <input type="hidden" id="sens" value="1.0">

    <!-- Add necessary scripts for puzzle visualization -->
    <script type="text/javascript" src="visualizer/engine/utilities.js"></script>
    <script type="text/javascript" src="visualizer/engine/svg.js"></script>
    <script type="text/javascript" src="visualizer/engine/polyominos.js"></script>
    <script type="text/javascript" src="visualizer/engine/puzzle.js"></script>
    <script type="text/javascript" src="visualizer/engine/solve.js"></script>
    <script type="text/javascript" src="visualizer/engine/validate.js"></script>
    <script type="text/javascript" src="visualizer/engine/display2.js"></script>
    <script type="text/javascript" src="visualizer/engine/trace2.js"></script>
    <script type="text/javascript" src="visualizer/engine/serializer.js"></script>
    <script type="text/javascript" src="visualizer/engine/custom_mechanics.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    
    <!-- Global puzzle data -->
    <script>
      // Define fallbackPuzzle globally to avoid duplication
      const fallbackPuzzle = {"difficulty_level":5,"difficulty_score":5.8,"grid_size":{"height":2,"width":3},"id":"176d1e37ebbacac0","polyshapes":{"16":"·█··\n····\n····\n····"},"puzzle_array":[["+","+","+","+","+",".","+"],["S","N","+","P-R-16","+","o-B","+"],["+","+","+","+","+","+","+"],["+","N","+","N","+","o-B","+"],["+","+","E","+","+","+","+"]],"solution_count":1,"solutions":[{"index":0,"path":[{"x":0,"y":1},{"x":0,"y":0},{"x":1,"y":0},{"x":2,"y":0},{"x":2,"y":1},{"x":2,"y":2},{"x":3,"y":2},{"x":4,"y":2},{"x":4,"y":1},{"x":4,"y":0},{"x":5,"y":0},{"x":6,"y":0},{"x":6,"y":1},{"x":6,"y":2},{"x":6,"y":3},{"x":6,"y":4},{"x":5,"y":4},{"x":4,"y":4},{"x":3,"y":4},{"x":2,"y":4}],"pathLength":20}],"text_visualization":"puzzle:\n  dimensions:\n    width: 3\n    height: 2\n  start:\n    x: 0\n    y: 1\n  end:\n    x: 2\n    y: 4\n  cells:\n    - position:\n        x: 3\n        y: 1\n      properties:\n        type: \"poly\"\n        polyshape: 16\n        color: \"red\"\n    - position:\n        x: 5\n        y: 0\n      properties:\n        dot: 1\n        color: \"black\"\n    - position:\n        x: 5\n        y: 1\n      properties:\n        type: \"square\"\n        color: \"blue\"\n    - position:\n        x: 5\n        y: 3\n      properties:\n        type: \"square\"\n        color: \"blue\"\n"};
    </script>

    <script>
      // Add active state to navigation links based on scroll position
      document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('section[id]');
        
        function setActiveLink() {
          let scrollPos = window.scrollY + 100;
          
          // Find the current section
          sections.forEach((section, i) => {
            if (section.offsetTop <= scrollPos && 
                (section.offsetTop + section.offsetHeight > scrollPos || i === sections.length - 1)) {
              
              // Remove active class from all links
              navLinks.forEach(link => {
                link.classList.remove('active');
                link.style.backgroundColor = '';
                link.style.color = '';
              });
              
              // Add active class to current link
              const currentLink = document.querySelector(`.nav-link[href="#${section.id}"]`);
              if (currentLink) {
                currentLink.classList.add('active');
                currentLink.style.backgroundColor = 'rgba(99, 102, 241, 0.1)';
                currentLink.style.color = 'var(--color-primary)';
              }
            }
          });
        }
        
        window.addEventListener('scroll', setActiveLink);
        setActiveLink();
      });
    </script>

    <script>
      // Center active items in the navigation bar on mobile
      document.addEventListener('DOMContentLoaded', function() {
        const navList = document.querySelector('.nav-list');
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('section[id]');
        let isMobile = window.innerWidth <= 768;
        
        // Function to center an item in the navigation
        function centerItemInNav(item) {
          if (!item || !isMobile) return;
          
          const navListWidth = navList.offsetWidth;
          const itemWidth = item.offsetWidth;
          const itemLeft = item.offsetLeft;
          const itemCenter = itemLeft + itemWidth / 2;
          const navListCenter = navListWidth / 2;
          const scrollLeft = itemCenter - navListCenter;
          
          navList.scrollTo({
            left: scrollLeft,
            behavior: 'smooth'
          });
        }
        
        // Center the item when clicking on a nav link
        navLinks.forEach(link => {
          link.addEventListener('click', function(e) {
            // Allow a moment for the active class to be added
            setTimeout(() => centerItemInNav(this), 100);
          });
        });
        
        // Function to update active state based on scroll position
        function setActiveLink() {
          let scrollPos = window.scrollY + 100;
          let activeLink = null;
          
          // Find the current section
          sections.forEach((section, i) => {
            if (section.offsetTop <= scrollPos && 
                (section.offsetTop + section.offsetHeight > scrollPos || i === sections.length - 1)) {
              
              // Remove active class from all links
              navLinks.forEach(link => {
                link.classList.remove('active');
                link.style.backgroundColor = '';
                link.style.color = '';
              });
              
              // Add active class to current link
              activeLink = document.querySelector(`.nav-link[href="#${section.id}"]`);
              if (activeLink) {
                activeLink.classList.add('active');
                activeLink.style.backgroundColor = 'rgba(99, 102, 241, 0.1)';
                activeLink.style.color = 'var(--color-primary)';
                
                // Center the active link
                centerItemInNav(activeLink);
              }
            }
          });
        }
        
        // Initial centering of active item
        window.addEventListener('load', function() {
          // Find the initial active link
          const initialActive = document.querySelector('.nav-link.active') || navLinks[0];
          if (initialActive) {
            initialActive.classList.add('active');
            initialActive.style.backgroundColor = 'rgba(99, 102, 241, 0.1)';
            initialActive.style.color = 'var(--color-primary)';
            
            // Give the browser a moment to calculate positions
            setTimeout(() => centerItemInNav(initialActive), 300);
          }
        });
        
        // Update on scroll
        window.addEventListener('scroll', setActiveLink);
        
        // Update on resize
        window.addEventListener('resize', function() {
          // Update mobile status
          isMobile = window.innerWidth <= 768;
          
          // Find the current active link and center it
          const currentActive = document.querySelector('.nav-link.active');
          if (currentActive) {
            centerItemInNav(currentActive);
          }
        });
        
        // Run initially
        setActiveLink();
      });
    </script>

    <script>
      // Prevent scrolling when interacting with puzzle on mobile
      document.addEventListener('DOMContentLoaded', function() {
        let puzzleContainer = document.getElementById('puzzle-container');
        let puzzle = document.getElementById('puzzle');
        
        // Function to setup handlers
        function setupHandlers() {
          // Get the latest references to elements (they might have been replaced)
          puzzleContainer = document.getElementById('puzzle-container');
          puzzle = document.getElementById('puzzle');
          
          if (!puzzleContainer || !puzzle) return;
        }
        
        // Set up the handlers initially
        setupHandlers();
        
        // Watch for puzzle changes and re-setup handlers
        const observer = new MutationObserver((mutations) => {
          for (const mutation of mutations) {
            if (mutation.type === 'childList' && (
                mutation.target.id === 'puzzle-container' || 
                mutation.target.id === 'puzzle')) {
              setupHandlers();
              break;
            }
          }
        });
        
        // Observe both the container and any parent elements as needed
        const exampleSection = document.getElementById('example');
        if (exampleSection) {
          observer.observe(exampleSection, { childList: true, subtree: true });
        }
        
        // Re-setup on randomization
        const randomizeBtn = document.getElementById('randomize-puzzle-btn');
        if (randomizeBtn) {
          randomizeBtn.addEventListener('click', () => {
            // Wait for new puzzle to load
            setTimeout(setupHandlers, 500);
          });
        }
      });
    </script>

    <!-- Puzzle Script -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Use the global fallbackPuzzle variable
        let currentPuzzle = fallbackPuzzle;
        let solutionVisible = false;
        let puzzlesCache = [];
        let isLoadingPuzzle = false;
        
        // Get DOM elements
        const showSolutionBtn = document.getElementById('show-solution-btn');
        const randomizePuzzleBtn = document.getElementById('randomize-puzzle-btn');
        
        // Add event listeners to buttons
        if (showSolutionBtn) {
          showSolutionBtn.addEventListener('click', toggleSolution);
        }
        
        if (randomizePuzzleBtn) {
          randomizePuzzleBtn.addEventListener('click', loadRandomPuzzle);
        }
        
        // Function to clean up previous puzzle state and event handlers
        function cleanupPreviousPuzzle() {
          // Remove any solution
          const existingSolution = document.getElementById('solution-path');
          if (existingSolution) {
            existingSolution.remove();
          }
          
          // Reset interaction state
          solutionVisible = false;
          
          // Clean up any global state set by the witness engine
          if (window.trace && window.trace.puzzle) {
            window.trace.cancel();
          }
          
          // Remove any global document touch/mouse handlers
          document.onmousemove = null;
          document.ontouchstart = null;
          document.ontouchmove = null;
          document.ontouchend = null;
          
          // Get the SVG element
          const svg = document.getElementById('puzzle');
          if (svg) {
            // Remove any event listeners attached to the SVG
            const newSvg = svg.cloneNode(false);
            if (svg.parentNode) {
              svg.parentNode.replaceChild(newSvg, svg);
            }
          }
          
          // Force garbage collection hints for old puzzle objects
          if (window.puzzleBoard) {
            window.puzzleBoard = null;
          }
          
          // Clean up any CSS animations
          const style = document.createElement('style');
          style.textContent = '.line-active, .line-success, .line-fail { animation: none !important; }';
          document.head.appendChild(style);
          setTimeout(() => {
            if (style.parentNode) style.parentNode.removeChild(style);
          }, 100);
        }
        
        // Toggle solution visibility
        function toggleSolution() {
          if (solutionVisible) {
            // Remove solution
            const existingSolution = document.getElementById('solution-path');
            if (existingSolution) {
              existingSolution.remove();
            }
            solutionVisible = false;
            showSolutionBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4M12 8h.01"></path></svg> Show Solution';
          } else {
            // Show solution
            displaySolution(currentPuzzle, 0);
            solutionVisible = true;
            showSolutionBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="8" y1="12" x2="16" y2="12"></line></svg> Hide Solution';
          }
        }
        
        // Load a random puzzle from the dataset
        function loadRandomPuzzle() {
          // Don't load a new puzzle if we're still loading one
          if (isLoadingPuzzle) return;
          
          isLoadingPuzzle = true;
          
          // Reset solution visibility state
          solutionVisible = false;
          if (showSolutionBtn) {
            showSolutionBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4M12 8h.01"></path></svg> Show Solution';
          }
          
          // Remove any displayed solution
          const existingSolution = document.getElementById('solution-path');
          if (existingSolution) {
            existingSolution.remove();
          }
          
          // Disable the button and show loading indicator
          if (randomizePuzzleBtn) {
            randomizePuzzleBtn.disabled = true;
            randomizePuzzleBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg> Loading...';
          }
          
          // If we have cached puzzles, use one of them
          if (puzzlesCache.length > 0) {
            // Get a random puzzle from the cache
            const randomIndex = Math.floor(Math.random() * puzzlesCache.length);
            const puzzleData = puzzlesCache[randomIndex];
            
            // Remove the used puzzle from cache
            puzzlesCache.splice(randomIndex, 1);
            
            // Update current puzzle
            currentPuzzle = puzzleData;
            
            // Reset solution visibility
            solutionVisible = false;
            if (showSolutionBtn) {
              showSolutionBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4M12 8h.01"></path></svg> Show Solution';
            }
            
            // Load the puzzle
            createPuzzleFromData(puzzleData);
            
            // Enable the button
            if (randomizePuzzleBtn) {
              randomizePuzzleBtn.disabled = false;
              randomizePuzzleBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.57-8.38"></path></svg> Random Dataset Puzzle';
            }
            
            isLoadingPuzzle = false;
          } else {
            // Load the dataset file
            fetch('puzzle_all_test.jsonl')
              .then(response => {
                if (!response.ok) {
                  throw new Error(`Network response was not ok: ${response.status}`);
                }
                return response.text();
              })
              .then(data => {
                // Split the file into lines
                const lines = data.split('\n').filter(line => line.trim().length > 0);
                
                // Cache some random puzzles for future use (up to 10)
                puzzlesCache = [];
                const maxCache = Math.min(10, lines.length);
                
                for (let i = 0; i < maxCache; i++) {
                  const randomLineIndex = Math.floor(Math.random() * lines.length);
                  try {
                    const puzzleJson = lines[randomLineIndex];
                    const puzzleData = JSON.parse(puzzleJson);
                    
                    // Only use the first as the current puzzle
                    if (i === 0) {
                      // Update current puzzle
                      currentPuzzle = puzzleData;
                      
                      // Reset solution visibility
                      solutionVisible = false;
                      if (showSolutionBtn) {
                        showSolutionBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4M12 8h.01"></path></svg> Show Solution';
                      }
                      
                      // Load the puzzle
                      createPuzzleFromData(puzzleData);
                    } else {
                      // Cache the rest
                      puzzlesCache.push(puzzleData);
                    }
                  } catch (err) {
                    console.error('Error parsing puzzle JSON:', err);
                  }
                }
                
                // Enable the button
                if (randomizePuzzleBtn) {
                  randomizePuzzleBtn.disabled = false;
                  randomizePuzzleBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.57-8.38"></path></svg> Random Dataset Puzzle';
                }
                
                isLoadingPuzzle = false;
              })
              .catch(error => {
                console.error('Error loading dataset:', error);
                
                // Fallback to the default puzzle
                currentPuzzle = fallbackPuzzle;
                createPuzzleFromData(fallbackPuzzle);
                
                // Enable the button
                if (randomizePuzzleBtn) {
                  randomizePuzzleBtn.disabled = false;
                  randomizePuzzleBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg> Loading...';
                }
                
                isLoadingPuzzle = false;
              });
          }
        }
        
        // Format polyshapes data properly
        function parsePolyshapes(polyshapesData) {
          // If it's already an object, return it
          if (typeof polyshapesData === 'object' && !Array.isArray(polyshapesData) && polyshapesData !== null) {
            return polyshapesData;
          }
          
          // If it's a string, try to parse it as JSON
          if (typeof polyshapesData === 'string') {
            try {
              return JSON.parse(polyshapesData);
            } catch (e) {
              // If it can't be parsed, return null
              return null;
            }
          }
          
          // Default return
          return null;
        }
        
        // Update puzzle stats
        function updatePuzzleStats(puzzleData) {
          // Update puzzle ID
          const puzzleIdElement = document.getElementById('puzzle-id');
          if (puzzleIdElement) {
            puzzleIdElement.textContent = puzzleData.id;
          }
          
          // Update difficulty
          const puzzleDifficultyElement = document.getElementById('puzzle-difficulty');
          if (puzzleDifficultyElement) {
            puzzleDifficultyElement.textContent = `Level ${puzzleData.difficulty_level} (${puzzleData.difficulty_score.toFixed(1)})`;
          }
          
          // Update grid size
          const puzzleGridSizeElement = document.getElementById('puzzle-grid-size');
          if (puzzleGridSizeElement) {
            puzzleGridSizeElement.textContent = `${puzzleData.grid_size.width}×${puzzleData.grid_size.height}`;
          }
          
          // Update path length
          const puzzlePathLengthElement = document.getElementById('puzzle-path-length');
          if (puzzlePathLengthElement && puzzleData.solutions && puzzleData.solutions.length > 0) {
            puzzlePathLengthElement.textContent = `${puzzleData.solutions[0].pathLength} steps`;
          }
        }
        
        // Create puzzle from the input data
        function createPuzzleFromData(puzzleData) {
          try {
            // First, remove any previous interaction state and event listeners
            cleanupPreviousPuzzle();
            
            // Clear previous puzzle if there was one
            const svg = document.getElementById('puzzle');
            while (svg && svg.firstChild) svg.removeChild(svg.firstChild);
            
            // Extract dimensions and create puzzle
            const width = puzzleData.grid_size.width;
            const height = puzzleData.grid_size.height;
            const puzzle = new Puzzle(width, height);
            
            // Make sure the puzzle object is stored in the global space for reference
            window.puzzleBoard = puzzle;
            
            // Adjust SVG viewBox based on grid size
            const cellSize = 41; // Standard cell size used in the visualization
            const padding = 50; // Padding around the grid
            const viewBoxWidth = width * 2 * cellSize + padding * 2;
            const viewBoxHeight = height * 2 * cellSize + padding * 2;
            
            // Update SVG viewBox to accommodate the puzzle size
            if (svg) {
              svg.setAttribute('viewBox', `0 0 ${viewBoxWidth} ${viewBoxHeight}`);
              
              // Add simple touch scroll prevention directly to the SVG
              svg.addEventListener('touchmove', function(e) {
                e.preventDefault();
              }, { passive: false });
              
              // Adjust container size ratio for extreme grid dimensions
              const puzzleContainer = document.getElementById('puzzle-container');
              if (puzzleContainer) {
                // Calculate aspect ratio and apply it to the container
                const aspectRatio = viewBoxWidth / viewBoxHeight;
                if (aspectRatio > 1.5) {
                  // Wide puzzle
                  puzzleContainer.style.width = '100%';
                  puzzleContainer.style.height = `${100 / aspectRatio}%`;
                } else if (aspectRatio < 0.7) {
                  // Tall puzzle
                  puzzleContainer.style.height = '100%';
                  puzzleContainer.style.width = `${100 * aspectRatio}%`;
                } else {
                  // Relatively square puzzle
                  puzzleContainer.style.width = '100%';
                  puzzleContainer.style.height = '100%';
                }
              }
            }
            
            // Parse YAML from text_visualization using js-yaml
            const yamlData = jsyaml.load(puzzleData.text_visualization);
            
            // Set start point
            const startX = yamlData.puzzle.start.x;
            const startY = yamlData.puzzle.start.y;
            puzzle.grid[startX][startY].start = true;
            
            // Set end point
            const endX = yamlData.puzzle.end.x;
            const endY = yamlData.puzzle.end.y;
            
            // Determine end direction based on position
            let endDirection;
            if (endX === 0) {
              endDirection = "left";
            } else if (endX === width * 2) {
              endDirection = "right";
            } else if (endY === 0) {
              endDirection = "top";
            } else if (endY === height * 2) {
              endDirection = "bottom";
            } else {
              // Default fallback if not on an edge
              endDirection = "left";
            }
            
            puzzle.grid[endX][endY].end = endDirection;
            
            // Parse polyshapes if in JSON string format
            const polyshapes = typeof puzzleData.polyshapes === 'string' ? 
                               parsePolyshapes(puzzleData.polyshapes) : 
                               puzzleData.polyshapes;
            
            // Add puzzle elements
            if (yamlData.puzzle.cells) {
              yamlData.puzzle.cells.forEach(cell => {
                const x = cell.position.x;
                const y = cell.position.y;
                
                if (x >= 0 && y >= 0 && x < puzzle.width && y < puzzle.height) {
                  if (cell.properties.type === 'poly' || cell.properties.type === 'ylop') {
                    const polyId = cell.properties.polyshape;
                    const polyshape = polyshapes && polyshapes[polyId];
                    
                    // Parse the ASCII polyshape into a numeric value
                    let polyValue = 0;
                    if (polyshape && typeof polyshape === 'string') {
                      const rows = polyshape.split('\n');
                      for (let y = 0; y < rows.length; y++) {
                        for (let x = 0; x < rows[y].length; x++) {
                          if (rows[x][y] === '█') {
                            // Set the bit for this position in the polyomino
                            polyValue |= (1 << (y * 4 + x));
                          }
                        }
                      }
                    }
                    
                    puzzle.grid[x][y] = {
                      type: cell.properties.type,
                      polyshape: polyValue || polyId, // Use parsed value or fall back to ID
                      color: cell.properties.color
                    };
                  } else if (cell.properties.type === 'square') {
                    puzzle.grid[x][y] = {
                      type: 'square',
                      color: cell.properties.color
                    };
                  } else if (cell.properties.type === 'star') {
                    puzzle.grid[x][y] = {
                      type: 'star',
                      color: cell.properties.color
                    };
                  } else if (cell.properties.type === 'triangle') {
                    puzzle.grid[x][y] = {
                      type: 'triangle',
                      color: cell.properties.color,
                      count: cell.properties.count
                    };
                  } else if (cell.properties.type === 'nega') {
                    puzzle.grid[x][y] = {
                      type: 'nega',
                      color: cell.properties.color
                    };
                  } else if (cell.properties.dot) {
                    puzzle.grid[x][y] = {
                      dot: window.DOT_BLACK,
                      type: 'line',
                      line: 0
                    };
                  } else if (cell.properties.gap) {
                    puzzle.grid[x][y] = {
                      gap: 1,
                      type: 'line',
                      line: 0
                    };
                  }
                }
              });
            }
            
            // Make sure the puzzle container is visible
            const puzzleContainer = document.getElementById('puzzle-container');
            if (puzzleContainer) {
              puzzleContainer.style.display = 'flex';
            }
            
            // Update the puzzle stats
            updatePuzzleStats(puzzleData);
            
            // Safety checks before using potentially dangerous functions
            if (typeof window.draw === 'function') {
              // Draw the puzzle
              window.draw(puzzle);
              
              // Make sure cursorPos element exists
              if (svg) {
                let cursorPosElement = document.getElementById('cursorPos');
                if (!cursorPosElement) {
                  cursorPosElement = document.createElementNS("http://www.w3.org/2000/svg", "defs");
                  cursorPosElement.id = "cursorPos";
                  svg.appendChild(cursorPosElement);
                }
                
                // Ensure trace handlers are initialized correctly
                if (typeof window.initTrace === 'function') {
                  // Delay trace initialization to ensure all elements are properly created
                  setTimeout(() => {
                    window.initTrace(svg.id, 1);
                  }, 100);
                }
              }
            } else {
              console.error('window.draw function not found. Puzzle scripts may not be loaded correctly.');
            }
          } catch (error) {
            console.error('Error creating puzzle:', error);
          }
        }
        
        // Display a solution on the puzzle
        function displaySolution(puzzleData, solutionIndex) {
          if (!puzzleData.solutions || puzzleData.solutions.length === 0) return;
          
          // Remove previous solution if it exists
          const existingSolution = document.getElementById('solution-path');
          if (existingSolution) {
            existingSolution.remove();
          }
          
          const solution = puzzleData.solutions[solutionIndex];
          const path = solution.path;
          
          // Draw the solution path on the puzzle
          const svg = document.getElementById('puzzle');
          if (!svg) return;
          
          const solutionGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
          solutionGroup.setAttribute("id", "solution-path");
          
          // Create a path element for the solution
          const pathElement = document.createElementNS("http://www.w3.org/2000/svg", "path");
          
          // Get the current viewBox dimensions from the SVG
          const viewBox = svg.getAttribute('viewBox')?.split(' ') || ['0', '0', '500', '500'];
          const viewBoxWidth = parseFloat(viewBox[2]);
          const viewBoxHeight = parseFloat(viewBox[3]);
          
          // Calculate scale and offset based on grid size
          const width = puzzleData.grid_size.width;
          const height = puzzleData.grid_size.height;
          const cellSize = 41; // Standard cell size
          const padding = 50; // Standard padding
          
          // Build path data with proper scaling
          let pathData = "";
          path.forEach((point, index) => {
            const x = point.x * cellSize + padding;
            const y = point.y * cellSize + padding;
            
            if (index === 0) {
              pathData += `M ${x} ${y} `;
            } else {
              pathData += `L ${x} ${y} `;
            }
          });
          
          pathElement.setAttribute("d", pathData);
          pathElement.setAttribute("stroke", "#38b000");
          pathElement.setAttribute("stroke-width", "8");
          pathElement.setAttribute("stroke-linecap", "round");
          pathElement.setAttribute("stroke-linejoin", "round");
          pathElement.setAttribute("fill", "none");
          pathElement.setAttribute("stroke-dasharray", "5000");
          pathElement.setAttribute("stroke-dashoffset", "5000");
          pathElement.style.animation = "drawLine 3s ease-in-out forwards";
          
          solutionGroup.appendChild(pathElement);
          svg.appendChild(solutionGroup);
          
          // Add animation
          if (!document.getElementById('drawLineAnimation')) {
            const style = document.createElement('style');
            style.id = 'drawLineAnimation';
            style.textContent = `
              @keyframes drawLine {
                to {
                  stroke-dashoffset: 0;
                }
              }
            `;
            document.head.appendChild(style);
          }
        }
        
        // Override potentially problematic functions with safer versions for this page
        window.PLAY_SOUND = function(soundType) {
          // No-op function for sounds
          console.log('Sound would play:', soundType);
        };
        
        window.TRACE_COMPLETION_FUNC = function(puzzle, path) {
          // No-op function for trace completion
          console.log('Puzzle solved!');
        };
        
        // Initialize when DOM is loaded
        setTimeout(() => {
          try {
            // Initialize with the initial puzzle
            createPuzzleFromData(currentPuzzle);
            
            // Preload some puzzles for faster randomization
            setTimeout(() => {
              loadRandomPuzzle();
            }, 1000);
          } catch (e) {
            console.error('Error initializing puzzle:', e);
          }
        }, 500);
      });
    </script>

    <!-- Add script to handle the interaction hint -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const interactionHint = document.getElementById('puzzle-interaction-hint');
        if (interactionHint) {
          // Hide the hint when clicked
          interactionHint.addEventListener('click', function() {
            interactionHint.style.opacity = '0';
            setTimeout(() => {
              interactionHint.style.display = 'none';
            }, 300);
          });
        }
      });
    </script>
  </body>
</html>
